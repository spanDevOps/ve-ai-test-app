version: 1
frontend:
  phases:
    preBuild:
      commands:
        - npm install
    build:
      commands:
        - npm run build
    postBuild:
      commands:
        - node server.js &
  artifacts:
    baseDirectory: public
    files:
      - '**/*'
      - '../server.js'
      - '../package.json'
  cache:
    paths:
      - node_modules/**/*
  customRules:
    - source: /api/<**>
      target: /api/$1
      status: "200"
      condition: null
    - source: /workspace-<*>/<**>
      target: /index.html
      status: "200"
      condition: null
      rewrites:
        - source: /workspace-<*>/<**>
          target: /workspace-$1/$2
    - source: /workspace-<*>
      target: /index.html
      status: "200"
      condition: null
      rewrites:
        - source: /workspace-<*>
          target: /workspace-$1
    - source: /<**>
      target: /index.html
      status: "404"
      condition: null
